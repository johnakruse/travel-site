<!DOCTYPE html>
<html lang="en_US">
<head>
<link rel="stylesheet" href="{{ url_for('static', filename='css/planner.css') }}">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>
<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
</head>
  <div class="planview">
    <div class="menu">
      <ul>
        <li class="dropdown"><a href="javascript:void(0)">Manage Plan</a></li>
        <li><a id="newday">+ New Day</a></li>
        <li><a>Budget</a></li>
      </ul>
    </div>
    <div class="day">
    </div>
    <div class="trip">
    </div>
    <div class="map">
      <div id="mapid"></div>
    </div>
  </div>
<script>
  var mymap = L.map('mapid').setView([42.331427, -83.046597], 13);
  L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
      attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
      maxZoom: 18,
      id: 'mapbox.streets',
      accessToken: '***REMOVED***'
  }).addTo(mymap);
  function onMapClick(e) {
    L.marker(e.latlng).addTo(mymap);
    $(".trip ul:last-child").append("<li>" + e.latlng + "</li>");
  }
  function onMapDrag() {
    var coordinates = mymap.getBounds();
    var request = new XMLHttpRequest();
    var FD = new FormData();
    FD.append('north', coordinates.getNorth());
    FD.append('south', coordinates.getSouth());
    FD.append('east', coordinates.getEast());
    FD.append('west', coordinates.getWest());
    FD.append('tourism', "true");
    request.open("POST", "/query/");
    console.log(FD);
    request.send(FD);
    var response = request.responseText;
    console.log(response);
  }
  mymap.on('click', onMapClick);
  $("#newday").on("click", function() {
    $(".trip").append("<ul></ul>");
  });
  mymap.on('drageend', onMapDrag)
</script>
</html>
